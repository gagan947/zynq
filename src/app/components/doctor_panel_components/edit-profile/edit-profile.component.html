<section class="ct_py_50">
      <div class="container-fluid ">
            <div class="row">
                  <div class="col-md-12  mx-auto">
                        <div class="d-flex align-items-center gap-3 mb-5">
                              <a class="ct_back_icon" routerLink="/doctor/my-profile"><i
                                          class="fa-solid fa-chevron-left"></i></a>
                              <h4 class="ct_fs_24 ct_black_text mb-0"><span class="ct_fw_600">{{'MyProfile' |
                                          translate}} </span>
                                    <span class="ct_text_op_07 ct_fs_16"> /
                                          {{'EditProfile' | translate}}</span>
                              </h4>
                        </div>


                        <div id="msform">
                              <!-- progressbar -->
                              <ul id="ct_form_progressbar">
                                    <li *ngFor="let step of steps; let i = index" [id]="step.id" class="cursor-pointer"
                                          [class.active]="i <= currentStep" (click)="currentStep = i">
                                          {{ step.label | translate }}
                                    </li>
                              </ul>
                              <!-- <div class="progress">
                                  <div class="progress-bar" [style.width]="progress"></div>
                                </div> -->

                              <form [formGroup]="personalForm" (ngSubmit)="onSubmitPersonal()" *ngIf="currentStep == 0">
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'PersonalDetails' |
                                                translate}}</h5>

                                          <div class="row">
                                                <div class="col-md-4">
                                                      <div class="form-group mb-4">
                                                            <label for="" class="mb-2 ct_text_black">{{'FirstName' |
                                                                  translate}}<span class="ct_red_text">*</span></label>
                                                            <input type="text" class="form-control ct_input"
                                                                  formControlName="fullName"
                                                                  placeholder="{{'Enter' | translate}} {{'FirstName' | translate}}">
                                                            <div *ngIf="personalForm.get('fullName')?.touched && personalForm.get('fullName')?.invalid"
                                                                  class="text-danger">
                                                                  {{'FirstName' | translate}}
                                                                  {{'isRequired' | translate}}.
                                                            </div>
                                                      </div>
                                                </div>

                                                <div class="col-md-4">
                                                      <div class="form-group mb-4">
                                                            <label for="" class="mb-2 ct_text_black">{{'LastName' |
                                                                  translate}} <span class="text-muted">({{'Optional' |
                                                                        translate}})</span></label>
                                                            <input type="text" class="form-control ct_input"
                                                                  formControlName="lastName"
                                                                  placeholder="{{'Enter' | translate}} {{'LastName' | translate}}">
                                                            <div *ngIf="personalForm.get('lastName')?.touched && personalForm.get('lastName')?.invalid"
                                                                  class="text-danger">
                                                                  {{'LastName' | translate}}
                                                                  {{'isRequired' | translate}}.
                                                            </div>
                                                      </div>
                                                </div>

                                                <div class="col-md-4">
                                                      <div class="form-group mb-4">
                                                            <label for="" class="mb-2 ct_text_black">{{'PhoneNo' |
                                                                  translate}}<span class="ct_red_text">*</span></label>
                                                            <!-- <input type="number" class="form-control ct_input"
                                                                  formControlName="phone" placeholder="Enter phone no"> -->

                                                            <ngx-intl-tel-input
                                                                  [cssClass]="'form-control ct_input w-full'"
                                                                  [enableAutoCountrySelect]="true"
                                                                  [enablePlaceholder]="true" [searchCountryFlag]="false"
                                                                  [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                                                                  [selectFirstCountry]="false"
                                                                  [selectedCountryISO]="selectedCountry"
                                                                  [onlyCountries]="preferredCountries" [maxLength]="15"
                                                                  [phoneValidation]="true"
                                                                  formControlName="phone"></ngx-intl-tel-input>
                                                            <div *ngIf="personalForm.get('phone')?.touched && personalForm.get('phone')?.invalid"
                                                                  class="text-danger">
                                                                  <div
                                                                        *ngIf="personalForm.get('phone')?.errors?.['required']">
                                                                        {{'PhoneNo' | translate}} {{'isRequired' |
                                                                        translate}}.
                                                                  </div>
                                                                  <div
                                                                        *ngIf="personalForm.get('phone')?.errors?.['validatePhoneNumber']">
                                                                        {{'Invalid' | translate}}
                                                                        {{'PhoneNo' | translate}}.
                                                                  </div>
                                                            </div>
                                                      </div>
                                                </div>


                                                <!-- <div class="col-md-12 mt-2">
                                                      <label for="" class="mb-2 ct_text_black">{{'Address' |
                                                            translate}}<span class="ct_red_text">*</span></label>
                                                      <textarea type="text" class="form-control ct_input"
                                                            formControlName="address"
                                                            placeholder="{{'Enter' | translate}} {{'Address' | translate}}"></textarea>
                                                      <div *ngIf="personalForm.get('address')?.touched && personalForm.get('address')?.invalid"
                                                            class="text-danger">
                                                            {{'Address' | translate}} {{'isRequired' | translate}}.
                                                      </div>
                                                </div> -->

                                                <div class="col-md-12 mt-4">
                                                      <div class="form-group mb-4">
                                                            <label for="" class="mb-2 ct_text_black">{{'Address' |
                                                                  translate}}<span class="ct_red_text">*</span></label>
                                                            <input type="text" class="form-control ct_input"
                                                                  placeholder="{{'Enter' | translate}} {{'Address' | translate}}"
                                                                  (input)="searchLocation($event)"
                                                                  formControlName="address">
                                                            <!-- when user enter location then show this div -->
                                                            <div class="ct_map_location_dropdown"
                                                                  *ngIf="locations.length > 0">
                                                                  <ul>
                                                                        @for (item of locations; track $index) {
                                                                        <li (click)="selectLocation(item.description)">
                                                                              {{item.description}}
                                                                        </li>
                                                                        }
                                                                  </ul>
                                                            </div>
                                                            <div *ngIf="personalForm.get('address')?.touched && personalForm.get('address')?.invalid"
                                                                  class="ct_text_red">
                                                                  {{'Address' | translate}} {{'isRequired' |
                                                                  translate}}.
                                                            </div>
                                                      </div>
                                                </div>
                                                <div class="col-md-12 mt-2">
                                                      <label for="" class="mb-2 ct_text_black">{{'Description' |
                                                            translate}}<span class="ct_red_text">*</span></label>
                                                      <textarea type="text" class="form-control ct_input h-auto"
                                                            formControlName="biography" rows="5"
                                                            placeholder="{{'Enter' | translate}} {{'Description' | translate}}"></textarea>
                                                      <div *ngIf="personalForm.get('biography')?.touched && personalForm.get('biography')?.invalid"
                                                            class="ct_text_red">
                                                            {{'Description' | translate}} {{'isRequired' |
                                                            translate}}.
                                                      </div>
                                                </div>
                                                <div class="col-md-12 mt-3">
                                                      <div class="form-group mb-0">
                                                            <label for="" class="mb-2 ct_text_black">{{'ProfileImage' |
                                                                  translate}} <span class="text-muted">({{'Optional' |
                                                                        translate}})</span>
                                                            </label>
                                                            <div class="">
                                                                  <div class="ct_upload_product_main"
                                                                        *ngIf="!imagePreview">
                                                                        <svg width="33" height="33" viewBox="0 0 33 33"
                                                                              fill="none"
                                                                              xmlns="http://www.w3.org/2000/svg">
                                                                              <path d="M5.87174 22.0167C4.26376 20.9403 3.20508 19.1073 3.20508 17.027C3.20508 13.9023 5.59376 11.3354 8.64473 11.0528C9.26883 7.25653 12.5654 4.36035 16.5384 4.36035C20.5114 4.36035 23.808 7.25653 24.4321 11.0528C27.4831 11.3354 29.8717 13.9023 29.8717 17.027C29.8717 19.1073 28.8131 20.9403 27.2051 22.0167M11.2051 21.6937L16.5384 16.3604M16.5384 16.3604L21.8717 21.6937M16.5384 16.3604V28.3604"
                                                                                    stroke="#9CA3AF"
                                                                                    stroke-width="2.66667"
                                                                                    stroke-linecap="round"
                                                                                    stroke-linejoin="round" />
                                                                        </svg>
                                                                        <p
                                                                              class="text-center ct_fs_18 ct_text_op_07 mb-0">
                                                                              {{'Upload' | translate}}
                                                                              {{'ProfileImage' | translate}}</p>
                                                                        <small
                                                                              class="text-center d-block ct_text_9CA3AF py-2">PNG,
                                                                              JPG
                                                                              up to
                                                                              5MB</small>
                                                                        <label for="ct_upload_product">
                                                                              <input type="file" name=""
                                                                                    (change)="onProfileImage($event)"
                                                                                    id="ct_upload_product"
                                                                                    class="d-none" accept="image/*">
                                                                              <div class="ct_browse_btn">
                                                                                    <span>{{'browseFile' |
                                                                                          translate}}</span>
                                                                              </div>
                                                                        </label>
                                                                  </div>
                                                                  <div class="ct_uploaded_img123 position-relative w-100 ct_upload_product_main"
                                                                        *ngIf="imagePreview">
                                                                        <div class="ct_uploaded_img_w">
                                                                              <img [src]="imagePreview" alt=""
                                                                                    style="object-fit: contain;" />
                                                                              <i class="fa-solid fa-xmark"
                                                                                    (click)="removeImage()"></i>
                                                                        </div>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                                    <button type="button" name="next"
                                          class="ct_form_next action-button  ct_black_btn float-end mx-1 "
                                          value="Update" (click)="nextStep()" [disabled]="loading">
                                          @if(loading){
                                          <div class="spinner-border" role="status">
                                                <span class="sr-only">Loading...</span>
                                          </div>
                                          }@else {
                                          {{'Update' | translate}}
                                          }
                                    </button>
                                    <button type="button" class="ct_form_next action-button ct_black_btn float-end mx-1"
                                          value="Next" (click)="next()">{{'Next' | translate}}</button>
                              </form>
                              <form *ngIf="currentStep == 1">
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'Certification' | translate}}
                                                {{'Type' | translate}} <span class="text-muted">({{'Optional' |
                                                      translate}})</span></h5>
                                          <ng-container>
                                                <ng-container>
                                                      <div class="ct_big_card_scroll_500 ct_custom_scroll ct_pe_40">
                                                            <div class="row mt-4"
                                                                  *ngFor="let cert of certificaTeypes; let i = index">
                                                                  <div class="col-md-6 mb-4">
                                                                        <label class="mb-2 ct_text_black">{{'Certificate'
                                                                              | translate}}
                                                                              {{'Name' | translate}}</label>
                                                                        <input type="text" class="form-control ct_input"
                                                                              placeholder="Enter institute"
                                                                              [(ngModel)]="cert.certification_name"
                                                                              [ngModelOptions]="{standalone: true}"
                                                                              readonly>
                                                                  </div>

                                                                  <div class="col-md-6">
                                                                        <div class="form-group mb-4 mb-md-0">
                                                                              <label class="mb-2 ct_text_black">{{'Certificate'
                                                                                    | translate}}
                                                                              </label>
                                                                              <div
                                                                                    class="d-flex align-items-center gap-2 ">
                                                                                    <div class="ct_flex_1">
                                                                                          <div
                                                                                                *ngIf="cert.upload_path; else uploadInput">
                                                                                                <a [href]="certificateURl+ cert.upload_path"
                                                                                                      target="_blank">
                                                                                                      <i
                                                                                                            class="fa fa-file"></i>
                                                                                                      View Uploaded
                                                                                                      Certificate
                                                                                                </a>
                                                                                                <button type="button"
                                                                                                      class="btn btn-sm btn-link text-danger p-0 ms-2"
                                                                                                      (click)="removePreview(i,cert.doctor_certification_id)">
                                                                                                      Change
                                                                                                </button>
                                                                                          </div>
                                                                                          <ng-template #uploadInput>
                                                                                                <input type="file"
                                                                                                      class="form-control ct_input"
                                                                                                      accept="image/*, application/pdf"
                                                                                                      style="padding: 13px 20px;"
                                                                                                      (change)="onFileChange($event, i)">
                                                                                          </ng-template>
                                                                                    </div>
                                                                                    @if(cert.upload_path){
                                                                                    <button type="button"
                                                                                          class="ct_red_btn"
                                                                                          (click)="removePreview(i, cert.doctor_certification_id)">
                                                                                          <i class="fa fa-trash"></i>
                                                                                    </button>
                                                                                    }
                                                                              </div>
                                                                        </div>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                </ng-container>
                                          </ng-container>
                                    </div>
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'Education' | translate}}
                                                <span class="text-muted">({{'Optional' | translate}})</span>
                                          </h5>

                                          <div class="row ct_border_btm_1 mb-3"
                                                *ngFor="let edu of education; let j = index">
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'Institute' |
                                                                  translate}}</label>
                                                            <input type="text" class="form-control ct_input"
                                                                  placeholder="{{'Enter' | translate}} {{'Institute' | translate}}"
                                                                  [(ngModel)]="edu.institution"
                                                                  [ngModelOptions]="{standalone: true}">
                                                      </div>
                                                </div>
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3 ">
                                                            <label for="" class="mb-2 ct_text_black">{{'Degree' |
                                                                  translate}}</label>
                                                            <div class="d-flex align-items-center gap-2">
                                                                  <div class="ct_flex_1">
                                                                        <input type="text" class="form-control ct_input"
                                                                              placeholder="{{'Enter' | translate}} {{'Degree' | translate}}"
                                                                              [(ngModel)]="edu.degree_name"
                                                                              [ngModelOptions]="{standalone: true}">
                                                                  </div>
                                                            </div>
                                                      </div>
                                                </div>
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'StartYear' |
                                                                  translate}}</label>
                                                            <input id="bday-month" type="month"
                                                                  class="form-control ct_input"
                                                                  [(ngModel)]="edu.start_year"
                                                                  [ngModelOptions]="{standalone: true}" />
                                                      </div>
                                                </div>
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'EndYear' |
                                                                  translate}}</label>
                                                            <!-- <input type="month" class="form-control ct_input"
                                                                  [(ngModel)]="edu.end_year"
                                                                  [ngModelOptions]="{standalone: true}" /> -->

                                                            @if(!edu.isOngoing){
                                                            <input type="month" class="form-control ct_input"
                                                                  [(ngModel)]="edu.end_year"
                                                                  [ngModelOptions]="{ standalone: true }"
                                                                  [disabled]="edu.isOngoing" />
                                                            }
                                                            <div class="form-check mt-2 mt-2">
                                                                  <input type="checkbox"
                                                                        class="form-check-input ct_custom_check me-2"
                                                                        id="ongoingCheck-{{ j }}"
                                                                        [(ngModel)]="edu.isOngoing"
                                                                        [ngModelOptions]="{ standalone: true }"
                                                                        (change)="edu.isOngoing ? edu.end_year = null : null" />
                                                                  <label class="form-check-label"
                                                                        for="ongoingCheck-{{ j }}">
                                                                        {{'CurrentlyPursuing' | translate}}
                                                                  </label>
                                                            </div>

                                                      </div>

                                                </div>
                                                <div class=" ms-auto mb-3">
                                                      <button type="button" class="ms-auto ct_red_btn"
                                                            (click)="removeEducation(j)" *ngIf="j > 0">
                                                            <i class="fa fa-trash"></i>
                                                      </button>
                                                </div>
                                          </div>
                                          <a href="javascript:void(0)" class="ct_blue_text" (click)="addEducation()">+
                                                {{'Add' | translate}} {{'Education' | translate}}</a>
                                    </div>
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'Experience' | translate}}
                                                <span class="text-muted">({{'Optional' | translate}})</span>
                                          </h5>

                                          <div class="row ct_border_btm_1 mb-3"
                                                *ngFor="let exp of experience; let k = index">
                                                <div class="col-md-12">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'Organization' |
                                                                  translate}}</label>
                                                            <input type="text" class="form-control ct_input"
                                                                  placeholder="{{'Enter' | translate}} {{'Organization' | translate}}"
                                                                  [(ngModel)]="exp.organisation_name"
                                                                  [ngModelOptions]="{standalone: true}">
                                                      </div>
                                                </div>
                                                <div class="col-md-12">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'Designation' |
                                                                  translate}}</label>
                                                            <input type="text" class="form-control ct_input"
                                                                  placeholder="{{'Enter' | translate}} {{'Designation' | translate}}"
                                                                  [(ngModel)]="exp.designation"
                                                                  [ngModelOptions]="{standalone: true}">
                                                      </div>
                                                </div>
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'StartDate' |
                                                                  translate}}</label>
                                                            <input type="date" class="form-control ct_input"
                                                                  [(ngModel)]="exp.start_date"
                                                                  [max]="maxDate | date:'yyyy-MM-dd'"
                                                                  [ngModelOptions]="{standalone: true}">
                                                      </div>
                                                </div>
                                                <div class="col-md-6">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'EndDate' |
                                                                  translate}}</label>
                                                            @if(!exp.isCurrent){
                                                            <input type="date" class="form-control ct_input"
                                                                  [(ngModel)]="exp.end_date"
                                                                  [ngModelOptions]="{standalone: true}"
                                                                  [disabled]="exp.isCurrent">
                                                            }
                                                            <div class="form-check mt-2 mt-2">
                                                                  <input type="checkbox"
                                                                        class="form-check-input ct_custom_check me-2"
                                                                        id="ongoingCheck-{{ k }}"
                                                                        [(ngModel)]="exp.isCurrent"
                                                                        [ngModelOptions]="{ standalone: true }"
                                                                        (change)="exp.isCurrent ? exp.end_date = null : null" />
                                                                  <label class="form-check-label"
                                                                        for="ongoingCheck-{{ k }}">
                                                                        {{'CurrentlyWorking' | translate}}
                                                                  </label>
                                                            </div>
                                                      </div>
                                                </div>
                                                <div class=" ms-auto mb-3">
                                                      <button type="button" class="ms-auto d-block ct_red_btn"
                                                            (click)="removeExperience(k)" *ngIf="k > 0">
                                                            <i class="fa fa-trash"></i>
                                                      </button>
                                                </div>
                                          </div>
                                          <a href="javascript:void(0)" class="ct_blue_text" (click)="addExperience()">+
                                                {{'Add' | translate}} {{'Expeiernce' | translate}}</a>
                                    </div>

                                    <button type="button" name="next"
                                          class="ct_form_next action-button  ct_black_btn float-end mx-1 "
                                          value="Update" (click)="nextStep()" [disabled]="loading">
                                          @if(loading){
                                          <div class="spinner-border" role="status">
                                                <span class="sr-only">Loading...</span>
                                          </div>
                                          }@else {
                                          {{'Update' | translate}}
                                          }
                                    </button>

                                    <button type="button" class="ct_form_next action-button ct_black_btn float-end mx-1"
                                          value="Next" (click)="next()">{{'Next' | translate}}</button>
                                    <button type="button"
                                          class="ct_form_next action-button ct_black_btn float-end mx-1 ct_outline_btn"
                                          value="Next" (click)="previous()">{{'Previous' | translate}}</button>
                              </form>
                              <form *ngIf="currentStep == 2" [formGroup]="Form">
                                    <div class=" ct_white_bg ct_p_40 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">
                                                {{'ServiceExpertise' | translate}}</h5>
                                          <div class="mb-4">
                                                <div class="d-flex align-items-center justify-content-between">
                                                      <label for="" class="mb-2 ct_text_black">{{'TreatmentsProvided' |
                                                            translate}}<span class="ct_red_text">*</span></label>
                                                      <input type="text" class="form-control w-25 mb-2"
                                                            [placeholder]="('Search' | translate) + ' ' + ('Treatment' | translate)"
                                                            (input)="onTreatmentSearch($event)" #searchInput>
                                                </div>
                                                <div class="table-responsive" style="max-height: 50vh;">
                                                      <table class="table ct_custom_table">
                                                            <thead>
                                                                  <tr>
                                                                        <th class="border p-2"></th>
                                                                        <th class="border p-2">{{'Treatment' |
                                                                              translate}}</th>
                                                                        <th class="border p-2">{{'Price' | translate}}
                                                                        </th>
                                                                        <th class="border p-2"></th>
                                                                  </tr>
                                                            </thead>
                                                            <tbody>
                                                                  @for (t of treatmentsArray.controls; track $index) {
                                                                  <tr>
                                                                        <td class="border p-2 text-center">
                                                                              <div
                                                                                    class="text-start form-check ct_custom_check mt-0">
                                                                                    <input type="checkbox"
                                                                                          [id]="'treatment-checkbox-'+$index"
                                                                                          class="form-check-input ct_custom_check mt-0"
                                                                                          [formControl]="getControl(t, 'selected')"
                                                                                          (change)="onTreatmentSelectChange($index)"
                                                                                          [checked]="t.get('selected')?.value"
                                                                                          [attr.aria-labelledby]="'treatment-checkbox-'+$index" />
                                                                              </div>
                                                                        </td>
                                                                        <td class="border p-2"><label
                                                                                    [attr.for]="'treatment-checkbox-'+$index"
                                                                                    class="ms-2">
                                                                                    {{ t.get('name')?.value }}
                                                                              </label></td>
                                                                        <td class="border p-2" style="width: 200px;">
                                                                              @if(t.get('selected')?.value &&
                                                                              subTreatments($index).controls.length ==
                                                                              0){
                                                                              <div>
                                                                                    <input type="number"
                                                                                          class="form-control"
                                                                                          placeholder="{{'Enter' | translate}} {{'Price' | translate}}"
                                                                                          [formControl]="getControl(t, 'price')" />
                                                                                    <small class="text-danger"
                                                                                          *ngIf="t.get('price')?.touched && t.get('price')?.hasError('required')">
                                                                                          {{'Price' | translate}}
                                                                                          {{'isRequired' | translate}}
                                                                                    </small>
                                                                                    <!-- <small class="text-danger"
                                                                                          *ngIf="t.get('price')?.touched && t.get('price')?.hasError('min')">
                                                                                          {{'Price' | translate}}
                                                                                          {{'mustBeGreaterThanOrEqualTo'
                                                                                          |
                                                                                          translate}} 3.
                                                                                    </small> -->
                                                                                    <small class="text-danger" *ngIf="t.get('price')?.touched && t.get('price')?.hasError('invalidPrice')">
                                                                                    {{'Price' | translate}} {{'mustBeGreaterThanOrEqualTo' | translate}} 2.
                                                                                    </small>
                                                                              </div>
                                                                              }@else {
                                                                              <span>{{t.get('price')?.value > 0 ?
                                                                                    t.get('price')?.value : ''}}</span>
                                                                              }
                                                                        </td>
                                                                        <td class="border p-2 align-middle text-center"
                                                                              style="width:40px">
                                                                              @if(subTreatments($index).controls.length
                                                                              > 0){
                                                                              <a href="javascript:void(0)"
                                                                                    class="text-dark"
                                                                                    data-bs-toggle="collapse"
                                                                                    [attr.data-bs-target]="'#collapseRecommendedSubTreatments'+$index"
                                                                                    [attr.aria-expanded]="'false'"
                                                                                    [attr.aria-controls]="'collapseRecommendedSubTreatments'+$index"
                                                                                    (click)="toggleRecommendedCollapse(recommendedCollapseStates, $index)">
                                                                                    <i class="fa"
                                                                                          [ngClass]="{
                                                                                                                                                                        'fa-chevron-down': !(recommendedCollapseStates[ $index ]),
                                                                                                                                                                        'fa-chevron-up': recommendedCollapseStates[ $index ]
                                                                                                                                                                  }"></i>
                                                                              </a>
                                                                              }
                                                                        </td>
                                                                  </tr>
                                                                  @if(subTreatments($index).controls.length
                                                                  > 0 && recommendedCollapseStates[$index] === true){
                                                                  <tr [id]="'collapseRecommendedSubTreatments'+$index">
                                                                        <td colspan="4" class="p-0 border-0">
                                                                              <div class=" p-3"
                                                                                    style="background-color: #f5f5f5;">
                                                                                    <table class="table  mb-0">
                                                                                          <thead>
                                                                                                <tr>
                                                                                                      <th
                                                                                                            class="border p-2">
                                                                                                      </th>
                                                                                                      <th
                                                                                                            class="border p-2">
                                                                                                            {{'SubTreatment'
                                                                                                            |
                                                                                                            translate}}
                                                                                                      </th>
                                                                                                      <th
                                                                                                            class="border p-2">
                                                                                                            {{'Price' |
                                                                                                            translate}}
                                                                                                      </th>
                                                                                                </tr>
                                                                                          </thead>
                                                                                          <tbody>
                                                                                                <tr
                                                                                                      *ngFor="let c of subTreatments($index).controls; let j = index">
                                                                                                      <td class="border p-2 text-center"
                                                                                                            style="width: 40px;">
                                                                                                            <div
                                                                                                                  class=" form-check ">
                                                                                                                  <input type="checkbox"
                                                                                                                        [id]="'sub-treatment-checkbox-'+$index+'-'+j"
                                                                                                                        class="form-check-input ct_custom_check mt-0 "
                                                                                                                        [formControl]="getChildControl($index, j, 'selected')"
                                                                                                                        (change)="onChildSelectChange($index, j)"
                                                                                                                        [checked]="c.get('selected')?.value"
                                                                                                                        [attr.aria-labelledby]="'sub-treatment-checkbox-'+$index+'-'+j" />
                                                                                                            </div>
                                                                                                      </td>
                                                                                                      <td
                                                                                                            class="border p-2">
                                                                                                            <label [attr.for]="'sub-treatment-checkbox-'+$index+'-'+j"
                                                                                                                  class="ms-2">
                                                                                                                  {{
                                                                                                                  c.get('name')?.value
                                                                                                                  }}
                                                                                                            </label>
                                                                                                      </td>
                                                                                                      <td class="border p-2"
                                                                                                            style="width: 200px;">
                                                                                                            @if(c.get('selected')?.value){
                                                                                                            <div>
                                                                                                                  <input type="number"
                                                                                                                        class="form-control"
                                                                                                                        placeholder="{{'Enter' | translate}} {{'Price' | translate}}"
                                                                                                                        [formControl]="getChildControl($index, j, 'price')" />

                                                                                                                  <small class="text-danger"
                                                                                                                        *ngIf="c.get('price')?.touched && c.get('price')?.hasError('required')">
                                                                                                                        {{'Price'
                                                                                                                        |
                                                                                                                        translate}}
                                                                                                                        {{'isRequired'
                                                                                                                        |
                                                                                                                        translate}}
                                                                                                                  </small>
                                                                                                                  <!-- <small class="text-danger"
                                                                                                                        *ngIf="c.get('price')?.touched && c.get('price')?.hasError('min')">
                                                                                                                        {{'Price'
                                                                                                                        |
                                                                                                                        translate}}
                                                                                                                        {{'mustBeGreaterThanOrEqualTo'
                                                                                                                        |
                                                                                                                        translate}}
                                                                                                                        3.
                                                                                                                  </small> -->
                                                                                                                  <small class="text-danger" *ngIf="c.get('price')?.touched && c.get('price')?.hasError('invalidPrice')">
                                                                                                                        {{'Price' | translate}} {{'mustBeGreaterThanOrEqualTo' | translate}} 2.
                                                                                                                  </small>

                                                                                                            </div>
                                                                                                            }
                                                                                                      </td>
                                                                                                </tr>
                                                                                          </tbody>
                                                                                    </table>
                                                                              </div>
                                                                        </td>
                                                                  </tr>
                                                                  }
                                                                  }
                                                            </tbody>
                                                      </table>

                                                </div>
                                          </div>
                                          <div class="mb-4">
                                                <label for="" class="mb-2 ct_text_black">{{'Devices' |
                                                      translate}} <span class="text-muted">({{'Optional' |
                                                            translate}})</span></label>
                                                <nz-select nzMode="multiple"
                                                      nzPlaceHolder="{{'Select' | translate}} {{'Devices' | translate}}"
                                                      class="form-control ct_input h-auto" formControlName="devices"
                                                      nzNotFoundContent="No Device Found">
                                                      @for (item of devices; track item) {
                                                      <nz-option [nzLabel]="item.device_name"
                                                            [nzValue]="item.id"></nz-option>
                                                      }
                                                </nz-select>
                                                <span class="ct_text_red mt-2"
                                                      *ngIf="Form.get('devices')?.invalid && Form.get('devices')?.touched">
                                                      {{'pleaseAddAtleast' | translate}} {{'Devices' | translate}}.
                                                </span>
                                          </div>
                                          <div class="mb-4">
                                                <label for="" class="mb-2 ct_text_black">{{'SkinTypeExpertise' |
                                                      translate}} <span class="text-muted">({{'Optional' |
                                                            translate}})</span></label>
                                                <nz-select nzMode="multiple"
                                                      nzPlaceHolder="{{'Select' | translate}} {{'SkinType' | translate}}"
                                                      class="form-control ct_input h-auto" formControlName="skin_types"
                                                      nzNotFoundContent="No Skin Types Found">
                                                      @for (item of skintypes; track item) {
                                                      <nz-option [nzLabel]="item.name"
                                                            [nzValue]="item.skin_type_id"></nz-option>
                                                      }
                                                </nz-select>
                                                <span class="ct_text_red mt-2"
                                                      *ngIf="Form.get('skin_types')?.invalid && Form.get('skin_types')?.touched">
                                                      {{'pleaseAddAtleast' | translate}} {{'SkinType' | translate}}.
                                                </span>
                                          </div>
                                          <div class="mb-4">
                                                <label for="" class="mb-2 ct_text_black">{{'SurgeriesProvided' |
                                                      translate}} <span class="text-muted">({{'Optional' |
                                                            translate}})</span></label>
                                                <nz-select nzMode="multiple"
                                                      nzPlaceHolder="{{'Select' | translate}} {{'Surgeries' | translate}}"
                                                      class="form-control ct_input h-auto" formControlName="surgeries"
                                                      nzNotFoundContent="No Severity Found">
                                                      @for (item of surgeries; track item) {
                                                      <nz-option [nzLabel]="item.english"
                                                            [nzValue]="item.surgery_id"></nz-option>
                                                      }
                                                </nz-select>
                                                <span class="ct_text_red mt-2"
                                                      *ngIf="Form.get('surgeries')?.invalid && Form.get('surgeries')?.touched">
                                                      {{'pleaseAddAtleast' | translate}} {{'Surgery' | translate}}.
                                                </span>
                                          </div>
                                    </div>
                                    <button type="button" name="next"
                                          class="ct_form_next action-button  ct_black_btn float-end mx-1 "
                                          value="Update" (click)="nextStep()" [disabled]="loading">
                                          @if(loading){
                                          <div class="spinner-border" role="status">
                                                <span class="sr-only">Loading...</span>
                                          </div>
                                          }@else {
                                          {{'Update' | translate}}
                                          }
                                    </button>

                                    <button type="button" class="ct_form_next action-button ct_black_btn float-end mx-1"
                                          value="Next" (click)="next()">{{'Next' | translate}}</button>
                                    <button type="button"
                                          class="ct_form_next action-button ct_black_btn float-end mx-1 ct_outline_btn"
                                          value="Next" (click)="previous()">{{'Previous' | translate}}</button>
                                    <!-- <input
                                type="button" name="previous" class="previous action-button-previous"
                                value="Previous" /> -->
                              </form>
                              <form *ngIf="currentStep == 3" [formGroup]="availabilityForm">
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'ConsultationFees' |
                                                translate}}</h5>
                                          <div class="row">
                                                <div class="col-md-12">
                                                      <div class="form-group mb-3">
                                                            <label for="" class="mb-2 ct_text_black">{{'FeeperSession' |
                                                                  translate}}<span class="ct_red_text">*</span></label>
                                                            <div class="position-relative">
                                                                  <input type="number" class="form-control ct_input"
                                                                        placeholder="{{'Enter' | translate}} {{'FeeperSession' | translate}}"
                                                                        formControlName="fee_per_session">
                                                                  <span class="ct_show_eye">SEK</span>
                                                            </div>
                                                            <div class="ct_text_red mt-1"
                                                                  *ngIf="availabilityForm.get('fee_per_session')?.hasError('required') && availabilityForm.get('fee_per_session')?.touched">
                                                                  {{'FeeperSession' | translate}}
                                                                  {{'isRequired' | translate}}.
                                                            </div>
                                                            <!-- <div class="ct_text_red mt-1"
                                                                  *ngIf="availabilityForm.get('fee_per_session')?.hasError('min') && availabilityForm.get('fee_per_session')?.touched">
                                                                  {{'FeeperSession' | translate}}
                                                                  {{'mustBeGreaterThanOrEqualTo' |
                                                                  translate}} 4.
                                                            </div> -->

                                                            <div class="text-danger" *ngIf="availabilityForm.get('fee_per_session')?.touched && availabilityForm.get('fee_per_session')?.hasError('invalidPrice')">
                                                                  {{'Price' | translate}} {{'mustBeGreaterThanOrEqualTo' | translate}} 2.
                                                            </div>


                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                                    <div class="ct_white_bg ct_p_20 ct_border_clr_e6e6e6 ct_border_radius_15 mb-4">
                                          <h5 class="ct_fs_20 ct_ff_ambit_semibold mb-3">{{'OperationHours' |
                                                translate}}</h5>
                                          <div class="py-3 border-bottom d-flex align-items-center gap-5">
                                                <label>
                                                      <input type="radio" class="form-check-input ct_custom_check me-1"
                                                            formControlName="sameForAllDays" [value]="true" />
                                                      {{'sameForAllDays' | translate}}
                                                </label>
                                                <label>
                                                      <input type="radio" class="form-check-input ct_custom_check me-1"
                                                            formControlName="sameForAllDays" [value]="false" />
                                                      {{'Customize' | translate}}
                                                </label>
                                          </div>
                                          <div formArrayName="days">
                                                <!-- If SAME FOR ALL DAYS is selected, show only one day (index 0) -->
                                                <div *ngIf="availabilityForm.get('sameForAllDays')?.value === true">
                                                      <div [formGroupName]="0" class="py-3 border-bottom">
                                                            <h6 class="mb-2">{{ daysOfWeek[0] }} (applies to all days)
                                                            </h6>
                                                            <ng-container>
                                                                  <div formArrayName="sessions">
                                                                        <div *ngFor="let session of getSessions(0).controls; let j = index"
                                                                              [formGroupName]="j">
                                                                              <div class="ct_grid_40_40_20 mb-3">
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'StartTime' |
                                                                                                      translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <input type="time"
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="start_time" />
                                                                                          </div>
                                                                                          <div *ngIf="session.get('start_time')?.touched && session.get('start_time')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'StartTime' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                    </div>
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'EndTime' |
                                                                                                      translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <input type="time"
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="end_time"
                                                                                                      min="00:00"
                                                                                                      max="24:00" />
                                                                                          </div>
                                                                                          <div *ngIf="session.get('end_time')?.touched && session.get('end_time')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'EndTime' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                    </div>
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'SessionDuration'
                                                                                                      | translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <nz-select
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="sessionDuration"
                                                                                                      nzPlaceHolder="Select session duration">
                                                                                                      <nz-option
                                                                                                            *ngFor="let duration of sessionDuration"
                                                                                                            [nzValue]="duration"
                                                                                                            [nzLabel]="duration"></nz-option>
                                                                                                </nz-select>
                                                                                          </div>
                                                                                          <div *ngIf="session.get('sessionDuration')?.touched && session.get('sessionDuration')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'SessionDuration' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                    </div>

                                                                                    <div>
                                                                                          <label
                                                                                                class="ct_575_label_none">&nbsp;</label>
                                                                                          <button type="button"
                                                                                                class="ct_delete_icon_l"
                                                                                                (click)="removeSession(0, j)">
                                                                                                <i
                                                                                                      class="fa-solid fa-xmark"></i>
                                                                                          </button>
                                                                                    </div>
                                                                              </div>
                                                                        </div>
                                                                  </div>
                                                                  <button type="button" class="ct_black_btn py-2 px-3"
                                                                        (click)="addSession(0)">+ Add Session</button>
                                                            </ng-container>
                                                      </div>
                                                </div>

                                                <!-- If CUSTOMIZE is selected, show all 7 days -->
                                                <div *ngIf="availabilityForm.get('sameForAllDays')?.value === false">
                                                      <div *ngFor="let dayCtrl of days.controls; let i = index"
                                                            [formGroupName]="i" class="py-3 border-bottom">
                                                            <div class="mb-2">
                                                                  <label>
                                                                        <input type="checkbox" formControlName="active"
                                                                              class="form-check-input ct_custom_check me-2" />
                                                                        {{ daysOfWeek[i] }}
                                                                  </label>
                                                            </div>
                                                            <div *ngIf="dayCtrl.get('active')?.value">
                                                                  <div formArrayName="sessions">
                                                                        <div *ngFor="let session of getSessions(i).controls; let j = index"
                                                                              [formGroupName]="j" class="ml-4 mb-2">
                                                                              <div class="ct_grid_40_40_20 mb-3">
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'StartTime' |
                                                                                                      translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <input type="time"
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="start_time" />
                                                                                          </div>
                                                                                          <div *ngIf="session.get('start_time')?.touched && session.get('start_time')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'StartTime' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                    </div>
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'EndTime' |
                                                                                                      translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <input type="time"
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="end_time" />
                                                                                          </div>
                                                                                          <div *ngIf="session.get('end_time')?.touched && session.get('end_time')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'EndTime' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                          {{session.errors}}
                                                                                          <!-- <div *ngIf="session.errors['timeRangeInvalid'] && (session.get('end_time')?.touched || session.get('start_time')?.touched)"
                                                                                                class="ct_text_red">
                                                                                                End time must be after
                                                                                                start time.
                                                                                          </div> -->
                                                                                    </div>
                                                                                    <div>
                                                                                          <div class="form-group">
                                                                                                <label for=""
                                                                                                      class="mb-2 ct_text_black">
                                                                                                      {{'SessionDuration'
                                                                                                      | translate}}
                                                                                                      <span
                                                                                                            class="ct_red_text">*</span></label>
                                                                                                <nz-select
                                                                                                      class="form-control ct_input"
                                                                                                      formControlName="sessionDuration"
                                                                                                      nzPlaceHolder="Select session duration">
                                                                                                      <nz-option
                                                                                                            *ngFor="let duration of sessionDuration"
                                                                                                            [nzValue]="duration"
                                                                                                            [nzLabel]="duration"></nz-option>
                                                                                                </nz-select>
                                                                                          </div>
                                                                                          <div *ngIf="session.get('sessionDuration')?.touched && session.get('sessionDuration')?.hasError('required')"
                                                                                                class="ct_text_red">
                                                                                                {{'SessionDuration' |
                                                                                                translate}}
                                                                                                {{'isRequired' |
                                                                                                translate}}.
                                                                                          </div>
                                                                                    </div>

                                                                                    <div>
                                                                                          <label>&nbsp;</label>
                                                                                          <button type="button"
                                                                                                class="ct_delete_icon_l"
                                                                                                (click)="removeSession(i, j)">
                                                                                                <i
                                                                                                      class="fa-solid fa-xmark"></i>
                                                                                          </button>
                                                                                    </div>
                                                                              </div>
                                                                        </div>
                                                                  </div>

                                                                  <button type="button" class="ct_black_btn py-2 px-3"
                                                                        (click)="addSession(i)">+ Add
                                                                        Session</button>
                                                            </div>
                                                      </div>
                                                </div>
                                          </div>
                                    </div>

                                    <button type="button" name="next"
                                          class="ct_form_next action-button  ct_black_btn float-end mx-1 " value="Next"
                                          (click)="nextStep()" [disabled]="loading">
                                          @if(loading){
                                          <div class="spinner-border" role="status">
                                                <span class="sr-only">Loading...</span>
                                          </div>
                                          }@else {
                                          {{'Update' | translate}}
                                          }
                                    </button>
                                    <input type="button" name="previous"
                                          class="previous action-button-previous ct_outline_btn mx-1 float-end"
                                          value="{{'Previous' | translate}}" (click)="previousStep()">

                              </form>
                        </div>
                  </div>
            </div>
      </div>
</section>

<div class="modal fade modal-lg" id="ct_feedback_detail_modal" tabindex="-1"
      aria-labelledby="ct_feedback_detail_modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                  <div class="modal-body">
                        <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true"
                              [aspectRatio]="38 / 27" [resizeToWidth]="190" [resizeToHeight]="135" format="png"
                              (imageCropped)="imageCropped($event)">
                        </image-cropper>
                  </div>
                  <div class="modal-footer">
                        <button type="button" class="ct_outline_btn" data-bs-dismiss="modal" #closeBtn>{{'Cancel' |
                              translate}}</button>
                        <button type="button" class="ct_black_btn" (click)="onDone()">{{'Done' | translate}}</button>
                  </div>
            </div>
      </div>
</div>